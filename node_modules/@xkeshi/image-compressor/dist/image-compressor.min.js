/*!
 * Image Compressor v0.5.3
 * https://github.com/xkeshi/image-compressor
 *
 * Copyright (c) 2017 Xkeshi
 * Released under the MIT license
 *
 * Date: 2017-12-29T06:11:20.022Z
 */
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):e.ImageCompressor=t()}(this,function(){"use strict";var e,t,r=(e=function(e){!function(t){var r=t.HTMLCanvasElement&&t.HTMLCanvasElement.prototype,n=t.Blob&&function(){try{return Boolean(new Blob)}catch(e){return!1}}(),o=n&&t.Uint8Array&&function(){try{return 100===new Blob([new Uint8Array(100)]).size}catch(e){return!1}}(),i=t.BlobBuilder||t.WebKitBlobBuilder||t.MozBlobBuilder||t.MSBlobBuilder,a=/^data:((.*?)(;charset=.*?)?)(;base64)?,/,u=(n||i)&&t.atob&&t.ArrayBuffer&&t.Uint8Array&&function(e){var t,r,u,l,c,s,f,h,m;if(!(t=e.match(a)))throw new Error("invalid data URI");for(r=t[2]?t[1]:"text/plain"+(t[3]||";charset=US-ASCII"),u=!!t[4],l=e.slice(t[0].length),c=u?atob(l):decodeURIComponent(l),s=new ArrayBuffer(c.length),f=new Uint8Array(s),h=0;h<c.length;h+=1)f[h]=c.charCodeAt(h);return n?new Blob([o?f:s],{type:r}):((m=new i).append(s),m.getBlob(r))};t.HTMLCanvasElement&&!r.toBlob&&(r.mozGetAsFile?r.toBlob=function(e,t,n){var o=this;setTimeout(function(){n&&r.toDataURL&&u?e(u(o.toDataURL(t,n))):e(o.mozGetAsFile("blob",t))})}:r.toDataURL&&u&&(r.toBlob=function(e,t,r){var n=this;setTimeout(function(){e(u(n.toDataURL(t,r)))})})),e.exports?e.exports=u:t.dataURLtoBlob=u}(window)},t=void 0,e(t={exports:{}},t.exports),t.exports),n=Object.prototype.toString,o={checkOrientation:!0,maxWidth:1/0,maxHeight:1/0,minWidth:0,minHeight:0,width:void 0,height:void 0,quality:.8,mimeType:"auto",convertSize:5e6,success:null,error:null},i=/^image\/.+$/;function a(e){return i.test(e)}var u=String.fromCharCode;var l=window.btoa;function c(e){var t=new DataView(e),r=void 0,n=void 0,o=void 0,i=void 0;if(255===t.getUint8(0)&&216===t.getUint8(1))for(var a=t.byteLength,l=2;l<a;){if(255===t.getUint8(l)&&225===t.getUint8(l+1)){o=l;break}l+=1}if(o){var c=o+10;if("Exif"===function(e,t,r){var n="",o=void 0;for(r+=t,o=t;o<r;o+=1)n+=u(e.getUint8(o));return n}(t,o+4,4)){var s=t.getUint16(c);if(((n=18761===s)||19789===s)&&42===t.getUint16(c+2,n)){var f=t.getUint32(c+4,n);f>=8&&(i=c+f)}}}if(i){var h=t.getUint16(i,n),m=void 0,v=void 0;for(v=0;v<h;v+=1)if(m=i+12*v+2,274===t.getUint16(m,n)){m+=8,r=t.getUint16(m,n),t.setUint16(m,1,n);break}}return r}!function(){function e(e){this.value=e}function t(t){var r,n;function o(r,n){try{var a=t[r](n),u=a.value;u instanceof e?Promise.resolve(u.value).then(function(e){o("next",e)},function(e){o("throw",e)}):i(a.done?"return":"normal",a.value)}catch(e){i("throw",e)}}function i(e,t){switch(e){case"return":r.resolve({value:t,done:!0});break;case"throw":r.reject(t);break;default:r.resolve({value:t,done:!1})}(r=r.next)?o(r.key,r.arg):n=null}this._invoke=function(e,t){return new Promise(function(i,a){var u={key:e,arg:t,resolve:i,reject:a,next:null};n?n=n.next=u:(r=n=u,o(e,t))})},"function"!=typeof t.return&&(this.return=void 0)}"function"==typeof Symbol&&Symbol.asyncIterator&&(t.prototype[Symbol.asyncIterator]=function(){return this}),t.prototype.next=function(e){return this._invoke("next",e)},t.prototype.throw=function(e){return this._invoke("throw",e)},t.prototype.return=function(e){return this._invoke("return",e)}}();var s=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},f=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),h=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},m=window,v=m.ArrayBuffer,d=m.FileReader,b=window.URL||window.webkitURL,g=/\.\w+$/;return function(){function e(t,r){s(this,e),this.result=null,t&&this.compress(t,r)}return f(e,[{key:"compress",value:function(e,t){var i=this,s=new Image;return t=h({},o,t),v||(t.checkOrientation=!1),new Promise(function(r,o){if((i=e)instanceof Blob||"[object Blob]"===n.call(i)){var i,s=e.type;if(a(s))if(b||d){if(b&&!t.checkOrientation)r(b.createObjectURL(e));else if(d){var f=new d,m=t.checkOrientation&&"image/jpeg"===s;f.onload=function(e){var t=e.target.result;r(m?h({url:function(e,t){var r=new Uint8Array(e),n=r.length,o="",i=void 0;for(i=0;i<n;i+=1)o+=u(r[i]);return"data:"+t+";base64,"+l(o)}(t,s)},function(e){var t=0,r=1,n=1;switch(e){case 2:r=-1;break;case 3:t=-180;break;case 4:n=-1;break;case 5:t=90,n=-1;break;case 6:t=90;break;case 7:t=90,r=-1;break;case 8:t=-90}return{rotate:t,scaleX:r,scaleY:n}}(c(t))):{url:t})},f.onabort=o,f.onerror=o,m?f.readAsArrayBuffer(e):f.readAsDataURL(e)}}else o(new Error("The current browser does not support image compression."));else o(new Error("The first argument must be an image File or Blob object."))}else o(new Error("The first argument must be a File or Blob object."))}).then(function(t){return new Promise(function(r,n){s.onload=function(){return r(h({},t,{naturalWidth:s.naturalWidth,naturalHeight:s.naturalHeight}))},s.onabort=n,s.onerror=n,s.alt=e.name,s.src=t.url})}).then(function(n){var o=n.naturalWidth,i=n.naturalHeight,u=n.rotate,l=void 0===u?0:u,c=n.scaleX,f=void 0===c?1:c,h=n.scaleY,m=void 0===h?1:h;return new Promise(function(n){var u=document.createElement("canvas"),c=u.getContext("2d"),h=o/i,v=Math.max(t.maxWidth,0)||1/0,d=Math.max(t.maxHeight,0)||1/0,b=Math.max(t.minWidth,0)||0,g=Math.max(t.minHeight,0)||0,p=o,w=i;if(v<1/0&&d<1/0?d*h>v?d=v/h:v=d*h:v<1/0?d=v/h:d<1/0&&(v=d*h),b>0&&g>0?g*h>b?g=b/h:b=g*h:b>0?g=b/h:g>0&&(b=g*h),t.width>0){w=(p=t.width)/h}else if(t.height>0){p=(w=t.height)*h}var y=-(p=Math.min(Math.max(p,b),v))/2,U=-(w=Math.min(Math.max(w,g),d))/2,B=p,x=w;if(Math.abs(l)%180==90){var k={width:w,height:p};p=k.width,w=k.height}u.width=p,u.height=w,c.fillStyle="transparent",c.fillRect(0,0,p,w),c.save(),c.translate(p/2,w/2),c.rotate(l*Math.PI/180),c.scale(f,m),c.drawImage(s,Math.floor(y),Math.floor(U),Math.floor(B),Math.floor(x)),c.restore(),a(t.mimeType)||(t.mimeType=e.type),e.size>t.convertSize&&"image/png"===t.mimeType&&(t.mimeType="image/jpeg");var M=function(e){n({naturalWidth:o,naturalHeight:i,result:e})};u.toBlob?u.toBlob(M,t.mimeType,t.quality):M(r(u.toDataURL(t.mimeType,t.quality)))})}).then(function(r){var n=r.naturalWidth,o=r.naturalHeight,u=r.result;if(b&&b.revokeObjectURL(s.src),u)if(u.size>e.size&&!(t.width>n||t.height>o||t.minWidth>n||t.minHeight>o))u=e;else{var l=new Date;u.lastModified=l.getTime(),u.lastModifiedDate=l,u.name=e.name,u.name&&u.type!==e.type&&(u.name=u.name.replace(g,function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r=a(e)?e.substr(6):"";return"jpeg"===r&&(r="jpg"),r&&t&&(r="."+r),r}(u.type)))}else u=e;return i.result=u,t.success&&t.success(u),Promise.resolve(u)}).catch(function(e){if(!t.error)throw e;t.error(e)})}}]),e}()});